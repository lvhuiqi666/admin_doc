# 智慧水域-大屏-水质模块

## 水质检测任务：

### 接口地址：v1/pc/water_quality/task/

### 请求方式：POST

### 请求参数：

| 参数名     | 类型 | 是否必传 | 命名   | 备注 |
| ---------- | ---- | -------- | ------ | ---- |
| projectIds | LIST | 是       | 项目ID |      |

### 请求示例:

```bash
{
    "projectIds": [1,2,3,4],
}
```

### 响应

#### 200

```bash
{
    "data": [
        {
            "waters_id": 30,  // 水域ID
            "c_time": "2021-10-22",  // 检测日期
            "province__name": "浙江省",  // 检测省份
            "num": 2,  // 监测点位
            "waters__name": "西湖",  // 水域名称
            "province_id": 1  // 省份ID
            "city__lat": "27.9856", // 城市纬度
            "city__lng": "120.6864", // 城市经度
        },
        {
            "waters_id": 31,
            "c_time": "2021-10-22",
            "province__name": "浙江省",
            "num": 1,
            "waters__name": "唐河",
            "province_id": 1,
            "city__lat": "27.9856", // 城市纬度
            "city__lng": "120.6864", // 城市经度
        }
    ],
    "retCode": 0,
    "retMsg": "成功 | Success"
}
```

## 水质检测任务详情-定点水质：

### 接口地址：v1/pc/water_quality/fixed/point/list/

### 请求方式：POST

### 请求参数：

| 参数名     | 类型   | 是否必传 | 命名     | 备注 |
| ---------- | ------ | -------- | -------- | ---- |
| projectIds | LIST   | 是       | 项目ID   |      |
| shipName   | STRING | 否       | 船的名称 | 筛选 |
| provinceId | INT    | 否       | 省份     | 筛选 |
| watersId   | INT    | 否       | 水域     | 筛选 |
| sTime      | STRING | 否       | 开始日期 | 筛选 |
| eTime      | STRING | 否       | 结束日期 | 筛选 |

### 请求示例:

```bash
{
    "projectIds": [1,2,3,4],
}
```

### 响应

#### 200

```bash
{
    "data": {
        "count": 2,
        "list": [
            {
                "id": 10,  // 定点水位ID
                "lng": "120.900683",  // 经度
                "lat": "30.21611",  // 纬度
                "ph": "7.19", // 
                "nh3": "0.016075216972",
                "nh4": "1.40598196393",
                "k": "0.0945891783567",
                "cod": "4.96931863727",
                "turbidity": "23.7403306613",
                "dissOxy": "78.3954008016",
                "oxySaturation": "9.97",
                "cTime": "1631666676.000000",
                "wqTs": null,
                "shipInfo": { // 船的信息
                    "id": 2,
                    "name": "测试船",
                    "number": "00022"
                },
                "watersInfo": {  // 水域信息
                    "provinceName": "浙江省",
                    "provinceId": 1,
                    "watersName": "西湖",
                    "waterQualityId": 13,
                    "watersId": 30
                }
            }
        ],
        "links": {
            "previous": null,
            "next": null
        }
    },
    "retCode": 0,
    "retMsg": "成功 | Success"
}
```

## 水质检测任务详情-动态水质：

### 接口地址：v1/pc/water_quality/dynamic/list/

### 请求方式：POST

### 请求参数：

| 参数名     | 类型   | 是否必传 | 命名           | 备注 |
| ---------- | ------ | -------- | -------------- | ---- |
| projectIds | LIST   | 是       | 项目ID         |      |
| shipName   | STRING | 否       | 船的名称       | 筛选 |
| provinceId | INT    | 否       | 省份           | 筛选 |
| watersId   | INT    | 否       | 水域           | 筛选 |
| sTime      | FLOAT  | 否       | 开始日期时间戳 | 筛选 |
| eTime      | FLOAT  | 否       | 结束日期时间戳 | 筛选 |

### 请求示例:

```bash
{
    "projectIds": [1,2,3,4],
}
```

### 响应

#### 200

```bash
{
    "data": {
        "count": 78149,
        "list": [
            {
                "height": "3.88547730446",
                "s_time": 1637228043,
                "ship": {
                    "number": "0004",
                    "id": 17,
                    "name": "QDF-0004"
                },
                "c_data": {
                    "id": 20,
                    "name": "南京市"
                },
                "wgs84_lat": "32.0413168",
                "c_time": 1637228097286.0,
                "a_data": {
                    "id": 20,
                    "name": "建邺区"
                },
                "ph": "",
                "cod": "",
                "waters": {
                    "id": 14,
                    "name": "莫愁湖"
                },
                "nh4": "",
                "nh3": "",
                "oxy_saturation": "",
                "_id": "61961e41ad0529004908bc9e",
                "p_data": {
                    "id": 2,
                    "name": "江苏省"
                },
                "k": "",
                "diss_oxy": "",
                "_cls": "wisdom_waters_service.models.DynamicWaterQuality",
                "water_quality": null,
                "chlorophy": "",
                "turbidity": "",
                "wgs84_lng": "118.7582365"
            },
        ]
    },
    "retCode": 0,
    "retMsg": "成功 | Success"
}
```

## 定点水质历史查询接口：

### 接口地址：v1/pc/history/fixed/point/day/

### 请求方式：POST

### 请求参数：

| 参数名   | 类型   | 是否必传 | 命名     | 备注 |
| -------- | ------ | -------- | -------- | ---- |
| watersId | INT    | 是       | 水域ID   |      |
| sTime    | STRING | 是       | 开始日期 |      |
| eTime    | STRING | 是       | 结束日期 |      |

### 请求示例:

```bash
{
    "watersId": 22,
    "sTime": "2021-06-01",
    "eTime": "2021-06-17"
}
```

### 响应

#### 200

```bash
{
    "data": [
        {
        		"water_quality_id": 25,  // 水质水域ID
        		"water_quality__name": "中唐河", // 水质名称
            "water_quality__number": "暗管-006",  // 水质的编号
            "c_time": "2021-06-16T00:00:52Z",  // 日期
            "k": "0",  // 钾离子
            "oxy_saturation": "3.07", // 溶解氧饱和度
            "diss_oxy": "40.4", // 溶解氧
            "nh4": "3.2", // nh4
            "cod": "23.9", // 化学需氧量
            "nh3": "0", // nh3
            "ph": "7.32",  // Ph
            "turbidity": "33.5", // 浊度
            "tp": "0.209", // 总磷
            "tn": "4.241", // 总氮
            "id": 24
        },
        {		
		        "water_quality_id": 25,  // 水质水域ID
        		"water_quality__name": "中唐河", // 水质名称
            "water_quality__number": "暗管-006",  // 水质的编号
            "c_time": "2021-06-15T00:28:53Z",
            "k": "0.1",
            "oxy_saturation": "0.0",
            "diss_oxy": "0",
            "nh4": "1.4",
            "cod": "65.8",
            "nh3": "0",
            "ph": "7.04",
            "turbidity": "47.5",
            "tp": "0.209", // 总磷
            "tn": "4.241", // 总氮
            "id": 23
        }
    ],
    "retCode": 0,
    "retMsg": "成功 | Success"
}
```

## 动态水质历史查询接口：

### 接口地址：v1/pc/history/dynamic/

### 请求方式：POST

### 请求参数：

| 参数名   | 类型   | 是否必传 | 命名               | 备注        |
| -------- | ------ | -------- | ------------------ | ----------- |
| watersId | INT    | 是       | 水域ID             |             |
| ts       | FLOAT  | 是       | 毫秒时间戳         | 当日凌晨0点 |
| category | STRING | 是       | 获取需要的指标类型 | 默认是tp    |

```bash
category: 详情：
ph ph值
nh3 nh3
nh4 nh4
k  钾离子
cod 化学需氧量
turbidity 浊度
diss_oxy 溶解氧
oxy_saturation 溶解氧饱和度
chlorophy 绿叶素
tn 总氮
tp 总磷
```

### 请求示例:

```bash
{
    "watersId": 2,
    "ts": 1635609600000,
    "category": "tp"
}
```

### 响应

#### 200

```bash
{
    "data": [
        {
            "height": "4.66137361526",
            "s_time": 1635651790,
            "ship": {
                "number": "0004",
                "id": 2,
                "name": "西湖前进号"
            },
            "c_data": {
                "id": 1,
                "name": "杭州市"
            },
            "wgs84_lat": "32.0371814",
            "c_time": 1635651789578.0,
            "a_data": {
                "id": 1,
                "name": "萧山区"
            },
            "ph": "",
            "cod": "",
            "waters": {
                "id": 2,
                "name": "西湖"
            },
            "nh4": "",
            "nh3": "",
            "oxy_saturation": "",
            "_id": "617e10cdad0529004617726c",
            "p_data": {
                "id": 1,
                "name": "浙江省"
            },
            "k": "",
            "diss_oxy": "",
            "_cls": "wisdom_waters_service.models.DynamicWaterQuality",
            "water_quality": {
                "id": 5,
                "name": "断面003"
            },
            "chlorophy": "",
            "turbidity": "",
            "wgs84_lng": "118.752899"
        },
    "retCode": 0,
    "retMsg": "成功 | Success"
}
```

## 动态水质历史查询接口-日筛选：

### 接口地址：v1/pc/history/dynamic/

### 请求方式：POST

### 请求参数：

| 参数名   | 类型 | 是否必传 | 命名           | 备注        |
| -------- | ---- | -------- | -------------- | ----------- |
| watersId | INT  | 是       | 水域ID         |             |
| tsList   | LIST | 是       | 毫秒时间戳列表 | 当日凌晨0点 |

### 请求示例:

```bash
{
    "watersId": 2,
    "tsList": [1631721600000, 1635609600000]
}
```

### 响应

#### 200

```bash
{
    "data": [
        {
            "result_list": [  // 水质相关信息
                {
                    "c_data": {
                        "id": 1,
                        "name": "杭州市"
                    },
                    "p_data": {
                        "id": 1,
                        "name": "浙江省"
                    },
                    "turbidity": "[u'turb']",
                    "water_quality": {
                        "id": 5,
                        "name": "断面003"
                    },
                    "wgs84_lat": "31.4001943",
                    "c_time": 1631750400000.0,
                    "chlorophy": "33",
                    "k": "23",
                    "_cls": "wisdom_waters_service.models.DynamicWaterQuality",
                    "oxy_saturation": "11",
                    "diss_oxy": "123",
                    "nh4": "12",
                    "a_data": {
                        "id": 1,
                        "name": "萧山区"
                    },
                    "cod": "123.12",
                    "nh3": "3",
                    "s_time": 1631893159,
                    "ph": "7.1",
                    "_id": "6144b6a7a541dda8ff126385",
                    "wgs84_lng": "120.866966",
                    "ship": {
                        "number": "0017",
                        "id": 2,
                        "name": "西湖前进号"
                    },
                    "waters": {
                        "id": 2,
                        "name": "西湖"
                    }
                }
            ],
            "ts": 1631721600000.0  // 日期时间戳 毫秒
        },
        {
            "result_list": [
                {
                    "height": "4.66137361526",
                    "s_time": 1635651790,
                    "ship": {
                        "number": "0004",
                        "id": 2,
                        "name": "西湖前进号"
                    },
                    "c_data": {
                        "id": 1,
                        "name": "杭州市"
                    },
                    "wgs84_lat": "32.0371814",
                    "c_time": 1635651789578.0,
                    "a_data": {
                        "id": 1,
                        "name": "萧山区"
                    },
                    "ph": "",
                    "cod": "",
                    "waters": {
                        "id": 2,
                        "name": "西湖"
                    },
                    "nh4": "",
                    "nh3": "",
                    "oxy_saturation": "",
                    "_id": "617e10cdad0529004617726c",
                    "p_data": {
                        "id": 1,
                        "name": "浙江省"
                    },
                    "k": "",
                    "diss_oxy": "",
                    "_cls": "wisdom_waters_service.models.DynamicWaterQuality",
                    "water_quality": {
                        "id": 5,
                        "name": "断面003"
                    },
                    "chlorophy": "",
                    "turbidity": "",
                    "wgs84_lng": "118.752899"
                }
            ],
            "ts": 1635609600000.0
        }
    ],
    "retCode": 0,
    "retMsg": "成功 | Success"
}
```

## 水质历史查询接口：

### 接口地址：v1/pc/history/water_quality/

### 请求方式：POST

### 请求参数：

| 参数名   | 类型   | 是否必传 | 命名     | 备注 |
| -------- | ------ | -------- | -------- | ---- |
| watersId | INT    | 是       | 水域ID   |      |
| sTime    | STRING | 是       | 开始日期 |      |
| eTime    | STRING | 是       | 结束日期 |      |

### 请求示例:

```bash
{
    "watersId": 22,
    "sTime": "2021-06-01",
    "eTime": "2021-06-17"
}
```

### 响应

#### 200

```bash
{
    "data": [
        {
            "c_time": "2021-06-16T00:00:52Z",  // 日期
            "k": "0",  // 钾离子
            "oxy_saturation": "3.07", // 溶解氧饱和度
            "diss_oxy": "40.4", // 溶解氧
            "nh4": "3.2", // nh4
            "cod": "23.9", // 化学需氧量
            "nh3": "0", // nh3
            "ph": "7.32",  // Ph
            "turbidity": "33.5", // 浊度
            "id": 24
        },
        {
            "c_time": "2021-06-15T00:28:53Z",
            "k": "0.1",
            "oxy_saturation": "0.0",
            "diss_oxy": "0",
            "nh4": "1.4",
            "cod": "65.8",
            "nh3": "0",
            "ph": "7.04",
            "turbidity": "47.5",
            "id": 23
        }
    ],
    "retCode": 0,
    "retMsg": "成功 | Success"
}
```

## 水质多日数据对比接口(新)：

### 接口地址：v1/pc/history/filter/day/

### 请求方式：POST

### 请求参数：

| 参数名   | 类型   | 是否必传 | 命名     | 备注     |
| -------- | ------ | -------- | -------- | -------- |
| watersId | INT    | 是       | 水域ID   |          |
| tsList   | LIST   | 是       | 日期筛选 |          |
| category | STRING | 是       | 类型     | 默认是tp |

### 请求示例:

```bash
{
    "tsDate": 1636646400000,
    "shipNum": "0004",
    "watersId": 14
}
```

```bash
category: 详情：
ph ph值
nh3 nh3
nh4 nh4
k  钾离子
cod 化学需氧量
turbidity 浊度
diss_oxy 溶解氧
oxy_saturation 溶解氧饱和度
chlorophy 绿叶素
tn 总氮
tp 总磷
```

### 响应

#### 200

```bash
{
    "data": [
    {
      "turbidity": "41.7",
      "chlorophy": "",
      "k": "0.0",
      "oxy_saturation": "6.16",
      "diss_oxy": "77.3",
      "nh4": "3.9",
      "cod": "58.1",
      "nh3": "0.0",
      "s_time": 1622615227,
      "ph": "7.57",
      "_id": "61cdda8cdffa7185502abe5f"
      "ship": {
                  "number": "0004",
                  "id": 17,
                  "name": "QDF-0004"
              },
     "waters": {
     				"id": 14,
              "name": "莫愁湖"
     	},
    ],
    "retCode": 0,
    "retMsg": "成功 | Success"
}
```

## 水质总览-详情列表接口：

### 接口地址：v1/pc/water_quality/overview/list/

### 请求方式：POST

### 请求参数：

| 参数名     | 类型   | 是否必传 | 命名     | 备注 |
| ---------- | ------ | -------- | -------- | ---- |
| provinceId | INT    | 否       | 省份ID   | 筛选 |
| cityId     | INT    | 否       | 市ID     | 筛选 |
| areaId     | INT    | 否       | 区域ID   | 筛选 |
| townId     | INT    | 否       | 镇ID     | 筛选 |
| villageId  | INT    | 否       | 乡ID     | 筛选 |
| watersId   | INT    | 否       | 水域ID   | 筛选 |
| sTime      | STRING | 否       | 开始时间 | 筛选 |
| eTime      | STRING | 否       | 结束时间 | 筛选 |
| projectIds | LIST   | 是       | 项目ID   |      |

### 请求示例:

* 

### 响应

#### 200

```bash
{
    "data": {
        "count": 17,
        "list": [
            {
                "id": 49,  // 项目ID
                "amount": null,  // 金额
                "num": "HMH-001",  // 项目编号
                "name": "昆明湖项目",  // 项目名称 
                "businessType": 6,  // 业务类型 见详情
                "projectType": 1,  // 项目类型
                "areas": "",  // 面积
                "distance": "",  // 地区
                "evaluation": null,  // 评价
                "provinceInfo": {},  // 省份信息
                "cityInfo": {},  // 城市信息
                "areaInfo": {},  // 区域信息
                "townInfo": {},
                "villageInfo": {},
                "areaType": null,  // 区域
                "watersInfo": {  // 水域信息
                    "id": 33,
                    "name": "昆明湖",
                    "quality": 1, // 水质等级  1:I ~ 6:VI 总共就6个等级
                },
                "sTime": "1635609600.000000",  // 开始时间
                "eTime": "1635609600.000000",  // 结束时间
                "saleAmount": null,  // 销售金额 
                "projectShip": [  // 几艘船
                    {
                        "shipId": 20,  // 船的ID
                        "shipType": 1,  // 船的类型 1:无人船  2:冲锋舟
                        "id": 19,  
                        "shipNumber": "0007",  // 船的编号
                        "shipName": "QDF-0007"  // 船的名称
                    }
                ],
                "salesType": null,  // 销售类型
                "oUser": "",  // 业主
                "oCompany": "",  // 业主单位
                "oMobile": "",  // 业主手机号
                "sUser": "",  // 销售姓名
                "sMobile": "",  // 销售手机号
                "sCompany": ""  // 销售公司
            },
        ],
        "links": {
            "previous": null,
            "next": "http://127.0.0.1:8000/v1/pc/business/overall/list/?page=2"
        }
    },
    "retCode": 0,
    "retMsg": "成功 | Success"
}
```

## 水质检测模块(新接口)：

### 接口地址：v1/pc/new/water_quality/task/

### 请求方式：POST

### 请求参数：

| 参数名     | 类型 | 是否必传 | 命名   | 备注 |
| ---------- | ---- | -------- | ------ | ---- |
| projectIds | LIST | 是       | 项目ID |      |

### 请求示例:

* 

### 响应

#### 200

```bash
{
    "data": {
        "count": 36,
        "list": [
            {
                "id": 61, // 水质表ID
                "quality": 2, // 水质等级
                "address": "",  // 地址
                "sLng": "12.21321312",  // 经度
                "sLat": "12.21321312", // 纬度
                "name": "后塘河",  // 检测任务名称
                "number": "0001", // 编号
                "mUser": "",
                "mMobile": "",
                "eLat": "12.21321312",
                "provinceInfo": { // 省份信息
                    "id": 1,
                    "name": "浙江省"
                },
                "cityInfo": {  // 城市信息
                    "id": 18,
                    "name": "宁波市"
                },
                "areaInfo": {  // 区域信息
                    "id": 19,
                    "name": "鄞州区"
                },
                "shipInfo": { // 船舶信息
                    "id": 17,
                    "name": "QDF-0004",
                    "number": "0004"
                },
                "watersInfo": {  // 水域信息
                    "id": 22,
                    "name": "后塘河"
                },
                "cTime": "1624291200.000000", // 创建日期
                "eLng": "12.21321312",
                "qualityCount": 443 // 检测点位
            }
        ],
        "links": {
            "previous": null,
            "next": "http://127.0.0.1:8000/v1/pc/new/water_quality/task/?page=2"
        }
    },
    "retCode": 0,
    "retMsg": "成功 | Success"
}
```

